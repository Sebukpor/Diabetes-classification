<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diabetes Detection</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script>
        // Load the TensorFlow.js model from a local path
        async function loadModel() {
            const model = await tf.loadLayersModel('model/model.json');
            console.log("Model loaded successfully!");
            return model;
        }

        // Preprocess the input data
        function preprocessInput(data) {
            const gender = data.gender === 'Female' ? 1 : 0;
            const smoking_history_mapping = {
                'never': 0,
                'former': 1,
                'current': 2,
                'not current': 3,
                'ever': 4,
                'No Info': 5
            };
            const smoking_history = smoking_history_mapping[data.smoking_history];

            // Create the input array
            const inputArray = [
                gender,
                data.age,
                data.hypertension,
                data.heart_disease,
                smoking_history,
                data.bmi,
                data.HbA1c_level,
                data.blood_glucose_level
            ];

            // Mean and standard deviation derived from the training data
            const mean = [0.41466000, 41.8858560, 0.07485, 0.03942, 2.17965, 27.3207671, 5.527507, 138.058060];
            const stdDev = [0.49302848, 22.51672729, 0.26314915, 0.19459204, 1.88964967, 6.63675023, 1.07066674, 40.70793251];

            const normalizedInput = inputArray.map((value, index) => (value - mean[index]) / stdDev[index]);

            // Convert the array to a Tensor
            return tf.tensor2d([normalizedInput]);
        }

        // Make the prediction
        async function predictDiabetes() {
            const model = await loadModel();

            // Sample input data from form fields
            const inputData = {
                gender: document.getElementById('gender').value,
                age: parseFloat(document.getElementById('age').value),
                hypertension: parseInt(document.getElementById('hypertension').value),
                heart_disease: parseInt(document.getElementById('heart_disease').value),
                smoking_history: document.getElementById('smoking_history').value,
                bmi: parseFloat(document.getElementById('bmi').value),
                HbA1c_level: parseFloat(document.getElementById('HbA1c_level').value),
                blood_glucose_level: parseFloat(document.getElementById('blood_glucose_level').value)
            };

            // Preprocess and predict
            const inputTensor = preprocessInput(inputData);
            const prediction = model.predict(inputTensor);
            const predictedClass = prediction.argMax(-1).dataSync()[0];
            const confidence = prediction.dataSync();

            const classLabels = ["non-diabetic", "diabetic"];
            const resultText = `Predicted Class: ${classLabels[predictedClass]} (${confidence[0].toFixed(4)}, ${confidence[1].toFixed(4)})`;

            // Display the result
            document.getElementById('predictionResult').innerText = resultText;
        }
    </script>
</head>
<body>
    <h1>Diabetes Detection</h1>
    <form>
        <label for="gender">Gender:</label>
        <select id="gender">
            <option value="Female">Female</option>
            <option value="Male">Male</option>
        </select><br><br>

        <label for="age">Age:</label>
        <input type="number" id="age" required><br><br>

        <label for="hypertension">Hypertension (0 or 1):</label>
        <input type="number" id="hypertension" min="0" max="1" required><br><br>

        <label for="heart_disease">Heart Disease (0 or 1):</label>
        <input type="number" id="heart_disease" min="0" max="1" required><br><br>

        <label for="smoking_history">Smoking History:</label>
        <select id="smoking_history">
            <option value="never">Never</option>
            <option value="former">Former</option>
            <option value="current">Current</option>
            <option value="not current">Not Current</option>
            <option value="ever">Ever</option>
            <option value="No Info">No Info</option>
        </select><br><br>

        <label for="bmi">BMI:</label>
        <input type="number" id="bmi" step="0.01" required><br><br>

        <label for="HbA1c_level">HbA1c Level:</label>
        <input type="number" id="HbA1c_level" step="0.01" required><br><br>

        <label for="blood_glucose_level">Blood Glucose Level:</label>
        <input type="number" id="blood_glucose_level" required><br><br>

        <button type="button" onclick="predictDiabetes()">Predict Diabetes</button>
    </form>

    <h2 id="predictionResult">Prediction will appear here.</h2>
</body>
</html>
